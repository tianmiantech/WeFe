# 联邦学习

在机器学习领域，通常情况下更多的样本、更丰富的维度，有助于开发出更优质的模型。

所以我们希望采取联合建模的方式，增加样本数或维度来提升模型品质，但往往联合建模面临着数据隐私、安全合规等问题的阻碍，联邦学习建模技术应运而生而生。

联邦学习（Federated Learning）是机器学习与隐私计算结合的一种技术，它实现了多个数据集在不交换样本的前提下进行多方联合机器学习建模。

这种方法与传统的样本集中式机器学习技术形成对比，传统的样本集中式机器学习需要将收集到的所有数据集上传到一个服务器，并将这些数据集合并为一个数据集后开始模型的训练。 
而联邦学习能使多个参与者的数据集在不共享的情况下进行建模训练，从而解决 **数据隐私**、**数据安全**、**数据访问权限** 等问题。

# 成员

联邦学习建模属于联合建模，建模所使用的数据集来自多方，每一方被称为是一个成员。

在 WeFe 平台中，初始化系统时，会向 union 服务进行身份登记，登记后便成为 WeFe 联邦中的一员，拥有成员身份，每个成员拥有唯一的 member_id。

在 board 服务的联邦相关功能中，可以查看联邦中的成员列表，以及各成员的数据集信息。

# 角色

WeFe 联邦学习系统中共有三种角色：

* `promoter`：发起方，建模任务的操作主导方。
* `provider`：协作方，建模任务的协助方，通常只需要将数据集进行授权之后等待发起方完成建模即可。
* `arbiter`：中间人，虚拟角色，不是一个实际的成员，用于横向联邦建模时聚合生成全局模型。

在联邦学习建模过程中，*多个成员之间的价值与地位是相同的*，但出于操作上管理的需要，我们设定提供 y 值（y值也叫标签或label）的一方为发起方（promoter），发起方主导建模过程的操作。

> 这种操作上的主导特权并不会伤害协作方（provider）的利益，因为协作方的数据集和产出的模型不会泄露给发起方。

# 横向联邦

**`横向联邦具有以下特点：`**

1. **以扩充样本数为目的，各方数据集需要提供相同的特征列表，都需要有 label。**
2. **训练后所有成员都能得到完整且相同的模型。**

<img src="//assets.processon.com/chart_image/6141ecabe0b34d66cf7f4b12.png" style="width:600px" />

横向联邦学习建模以扩充样本数量为目的，所有参与者提供的数据集都需要有 **label** 和 **相同的特征列表**
，如果各成员提供的原始数据集存在额外的特征，需要进行特征对齐，即特征列表取交集，丢弃其他特征列，特征对齐后的数据集才能参与横向联邦建模。

<img src="//assets.processon.com/chart_image/6141f1c6079129629e0f2c84.png" style="width:600px"/>

横向联邦需要借助一个虚拟的成员 arbiter 来进行安全聚合， arbiter 是一个中立的服务，部署在何处并不影响整体的安全性，所以在 WeFe 系统中 arbiter 由发起方启动。

在建模结束后，所有参与者都能获得由多方数据共同训练得到的完整模型，模型的后续使用不依赖其他成员。

# 纵向联邦

**`纵向联邦具有以下特点：`**

1. **以扩充特征数为目的，各方数据集需要提供相同主键的样本，仅一方有 label。**
2. **训练后所有成员都只能得到与己方特征相关的部分的模型。**

<img src="//assets.processon.com/chart_image/60f7f0b5e401fd4cdec54b5c.png" style="width:600px" />

纵向联邦学习建模以扩充特征数量为目的，所有参与者提供的数据集都需要进行主键对齐，也叫样本对齐，样本对齐后的数据集才能参与纵向联邦建模。

> 样本对齐是指，多个数据集按主键求交集，各数据集仅保留主键在交集中的样本。

<img src="//assets.processon.com/chart_image/6145efc30e3e74524c92afd4.png" style="width:600px"/>

纵向联邦不需要 arbiter 服务的存在，建模结束后不存在完整的模型，所有参与者都只能得到与己方特征相关的部分的模型，模型的后续使用需要所有成员的参与。

# 混合联邦

**`混合联邦具有以下特点：`**

1. **以同时扩充特征数和样本数为目的，是横向联邦与纵向联邦的结合。**
2. **训练后所有成员都只能得到与己方特征相关的部分的模型。**

<img src="//assets.processon.com/chart_image/6141ecb563768941d2762e7a.png" style="width:600px" />

混合联邦在一个建模任务中同时包含了横向联邦与纵向联邦，由于包含纵向联邦，所以所有参与者都只能得到与己方特征相关的部分的模型。

以上图为例，模型的后续使用需要 **A + B** 或者 **C + B** 才能拼合出一个完整的模型进行预测。